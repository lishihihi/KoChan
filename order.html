<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kochan – Đặt món</title>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, Roboto, Arial;
  background: #f4f4f4;
}
.container {
  max-width: 480px;
  margin: auto;
  background: #fff;
  padding: 12px;
}
h2 {
  margin: 16px 0 8px;
  font-size: 18px;
  border-left: 4px solid #e53935;
  padding-left: 8px;
}
.menu-img {
  width: 100%;
  border-radius: 10px;
  margin-bottom: 10px;
}
.field input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px dashed #ddd;
}
.item-name {
  font-size: 15px;
}
.item-price {
  color: #e53935;
  font-weight: bold;
  font-size: 14px;
}
.qty {
  display: flex;
  align-items: center;
}
.qty button {
  width: 32px;
  height: 32px;
  border: none;
  background: #eee;
  font-size: 18px;
}
.qty span {
  width: 32px;
  text-align: center;
  font-size: 16px;
}
.total {
  font-size: 18px;
  font-weight: bold;
  text-align: right;
  margin-top: 12px;
}
button.submit {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  background: #e53935;
  color: #fff;
  border: none;
  border-radius: 10px;
  margin-top: 12px;
}
</style>
</head>

<body>
<div class="container">

<img src="menu1.jpg" class="menu-img">
<img src="menu2.jpg" class="menu-img">

<h2>Thông tin khách</h2>
<div class="field">
  <input id="name" placeholder="Tên người đặt">
  <input id="phone" placeholder="Số điện thoại" inputmode="numeric">
  <input id="address" placeholder="Địa chỉ giao hàng">
</div>

<h2>Combo</h2>
<div id="items"></div>

<h2>Gà rán</h2>
<div id="fried-chicken"></div>

<h2>Cơm & Mỳ</h2>
<div id="rice-pasta"></div>

<div class="total">Tổng: <span id="total">0</span>k</div>

<button class="submit" onclick="submitOrder()">ĐẶT MÓN</button>

</div>

<script>
// Menu Combo
const comboMenu = [
  { name: "Gà viên 2 loại sốt, kimpab, khoai tây", price: 49 },
  { name: "Gà viên sốt, mì ý, khoai tây chiên", price: 50 },
  { name: "Gà viên 3 loại sốt, 1 kimpab", price: 100 },
  { name: "Gà viên 2 loại sốt, 1 kimpab, khoai tây chiên", price: 115 },
  { name: "4 miếng gà, 1 kimpab, khoai tây chiên, salad", price: 99 },
  { name: "Gà nguyên con, 1 kimpab, khoai tây chiên, salad", price: 129 },
  { name: "4 miếng gà, 2 xúc xích, 1 kimpab thường, 1 kimpab chiên, khoai tây chiên, salad", price: 139 }
];

// Menu Gà rán
const friedChickenMenu = [
  { name: "Gà nguyên con", price: 99 },
  { name: "Nửa con gà (đùi, ức, cánh)", price: 60 },
  { name: "Gà viên chiên giòn", price: 25 },
  { name: "Gà viên phủ sốt cay", price: 30 },
  { name: "Gà viên phủ sốt kem", price: 30 },
  { name: "Gà viên phủ sốt phô mai", price: 30 },
  { name: "Đùi gà, khoai tây chiên", price: 30 },
  { name: "Đùi gà chiên giòn", price: 25 },
  { name: "Đùi gà phủ sốt cay", price: 30 },
  { name: "Đùi gà phủ sốt kem", price: 30 },
  { name: "Đùi gà phủ sốt phô mai", price: 30 },
  { name: "Gà nửa con phủ sốt cay", price: 70 },
  { name: "Gà nửa con phủ sốt kem", price: 70 },
  { name: "Gà nửa con phủ sốt phô mai", price: 70 }
];

// Menu Cơm & Mỳ
const ricePastaMenu = [
  { name: "Kimpab thường", price: 30 },
  { name: "Kimpab chiên", price: 35 },
  { name: "Mỳ ý xúc xích", price: 25 },
  { name: "Khoai tây chiên", price: 25 },
  { name: "Khoai tây lắc phô mai", price: 30 }
];

const allMenus = [...comboMenu, ...friedChickenMenu, ...ricePastaMenu];
const itemsDiv = document.getElementById("items");
const friedDiv = document.getElementById("fried-chicken");
const riceDiv = document.getElementById("rice-pasta");

// Lưu số lượng + menuItem
const quantities = {};

// Render menu
function renderMenu(menuArray, container) {
  menuArray.forEach((m,i)=>{
    const id = container.id + "-" + i;
    quantities[id] = { qty: 0, menuItem: m };
    container.innerHTML += `
      <div class="item" id="${id}">
        <div>
          <div class="item-name">${m.name}</div>
          <div class="item-price">${m.price}k</div>
        </div>
        <div class="qty">
          <button onclick="changeQty('${id}',-1)">−</button>
          <span id="q${id}">0</span>
          <button onclick="changeQty('${id}',1)">+</button>
        </div>
      </div>
    `;
  });
}

renderMenu(comboMenu, itemsDiv);
renderMenu(friedChickenMenu, friedDiv);
renderMenu(ricePastaMenu, riceDiv);

// Thay đổi số lượng với kiểm tra phòng thủ
function changeQty(id, d) {
  const next = quantities[id].qty + d;
  if (!Number.isInteger(next) || next < 0 || next > 99) return; // Giới hạn 0→99
  quantities[id].qty = next;
  document.getElementById("q"+id).innerText = next;
  calcTotal();
}

// Format số có dấu phẩy
function formatNumber(num) {
  return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
}

// Tính tổng tiền
function calcTotal() {
  let total = 0;
  Object.values(quantities).forEach(q=>total += q.qty*q.menuItem.price);
  document.getElementById("total").innerText = formatNumber(total);
}

// Kiểm tra tên hợp lệ
function isValidName(name) { return /^[a-zA-ZÀ-ỹ\s]+$/.test(name); }
// Kiểm tra số điện thoại
function isValidPhone(phone) { return /^[0-9]+$/.test(phone); }

// Gửi đơn với kiểm tra số lượng phòng thủ
function submitOrder() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();

  if (!name || !phone || !address) return alert("Nhập tên, SĐT và địa chỉ");
  if (!isValidName(name)) return alert("Tên không được chứa số hoặc ký tự đặc biệt");
  if (!isValidPhone(phone)) return alert("Số điện thoại chỉ được chứa số");

  const items = [];
  for (let k of Object.keys(quantities)) {
    const q = quantities[k].qty;
    if (!Number.isInteger(q) || q < 0 || q > 99) {
      alert("Số lượng món không hợp lệ");
      throw new Error("Invalid quantity");
    }
    if (q > 0) {
      items.push({ name: quantities[k].menuItem.name, qty: q, price: quantities[k].menuItem.price });
    }
  }

  if (!items.length) return alert("Chưa chọn món");

  const total = Object.values(quantities).reduce((sum,q)=>sum+q.qty*q.menuItem.price,0);

  const orderData = { name, phone, address, items, total };

  fetch("https://script.google.com/macros/s/ABCDE12345/exec", {
    method: "POST",
    body: JSON.stringify(orderData),
    headers: {"Content-Type": "text/plain;charset=utf-8"}
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") alert("Đặt món thành công!");
    else alert("Lỗi: " + data.message);
  })
  .catch(err => alert("Lỗi gửi đơn: " + err));
}
</script>

</body>
</html>
>
